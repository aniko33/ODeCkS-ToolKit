from pyzbar.pyzbar import decode
import cv2
import zlib
import base45
import cbor2
from cose.messages import CoseMessage
from cose.headers import Algorithm, KID
import json
from urllib.request import urlopen
filename = input('Filename > ')
img = cv2.imread(filename)
gray_img = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)
decoded = decode(gray_img)
payload = decoded[0].data[4:]
decoded = base45.b45decode(payload)
decompressed = zlib.decompress(decoded)
cose = CoseMessage.decode(decompressed)
data = cbor2.loads(cose.payload)
print('+----------------------------------+')
print('Data: '+data)
print('+----------------------------------+')
print('COSE code: '+cose)
print('+----------------------------------+')
print('Payload: '+payload)
print('+----------------------------------+')